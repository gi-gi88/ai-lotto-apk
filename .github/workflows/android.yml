# .github/workflows/android.yml
name: Build Cordova APK

# main 브랜치에 push 되거나, 수동(trigger)으로도 실행됩니다.
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    name: Build Android APK
    runs-on: ubuntu-latest

    steps:
    # 1) 코드 체크아웃
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2) Java 세팅 (Android SDK 용)
    - name: Set up Java 11
      uses: actions/setup-java@v3
      with:
        distribution: temurin
        java-version: '11'

    # 3) Node.js (Cordova 등) 세팅
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'

    # 4) 의존성 설치
    - name: Install Cordova & npm deps
      run: |
        npm install -g cordova
        npm ci

    # 5) Cordova Android 빌드
    - name: Build Cordova Android (release)
      run: cordova build android --release

    # 6) 출력 APK 파일 복사/이름 변경
    - name: Copy & rename APK
      run: |
        cp platforms/android/app/build/outputs/apk/release/app-release-unsigned.apk app-debug.apk

    # 7) APK 아티팩트 업로드
    - name: Upload app-debug.apk
      uses: actions/upload-artifact@v3
      with:
        name: app-debug-apk
        path: app-debug.apk

    # 8) PDF ⎯ 추천결과.pdf 업로드
    - name: Upload 추천결과.pdf
      uses: actions/upload-artifact@v3
      with:
        name: 추천결과
        path: 추천결과.pdf

    # 9) CSV ⎯ 북마크통계.csv 업로드
    - name: Upload 북마크통계.csv
      uses: actions/upload-artifact@v3
      with:
        name: 북마크통계
        path: 북마크통계.csv

    # 10) 설치안내서.txt 업로드
    - name: Upload 설치안내서.txt
      uses: actions/upload-artifact@v3
      with:
        name: 설치안내서
        path: 설치안내서.txt

    # 11) QR 이미지 업로드
    - name: Upload QR_설치.png
      uses: actions/upload-artifact@v3
      with:
        name: QR_설치
        path: QR_설치.png
