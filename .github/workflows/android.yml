# .github/workflows/android.yml
name: Build Cordova APK

# 푸시(Push) / PR 생성(PR) 시 워크플로 실행
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    name: 📦 Build Android APK
    runs-on: ubuntu-latest

    steps:
      # 1) 깃 클론
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2) Java 설치 (Android SDK 요구)
      - name: Set up Java 11
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '11'

      # 3) Node.js 설치 (Cordova / npm 필요)
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'     # 프로젝트에 맞게 조정

      # 4) 의존성 설치
      - name: Install dependencies
        run: npm ci

      # 5) Cordova Android 플랫폼 추가 / 빌드 준비
      - name: Prepare Cordova Android
        run: |
          npx cordova platform rm android || true
          npx cordova platform add android@11.0.0   # 버전 조정 가능

      # 6) APK 디버그 빌드
      - name: Build APK (debug)
        run: npx cordova build android --debug

      # 7) 아티팩트(빌드 결과물) 업로드
      - name: Upload APK artifact
        uses: actions/upload-artifact@v3
        with:
          name: app-debug-apk
          path: platforms/android/app/build/outputs/apk/debug/app-debug.apk

      # (선택) 추가 보조 파일 업로드
      - name: Upload CSV statistics
        uses: actions/upload-artifact@v3
        with:
          name: 북마크통계-csv
          path: 북마크통계.csv

      - name: Upload PDF recommendation
        uses: actions/upload-artifact@v3
        with:
          name: 추천결과-pdf
          path: 추천결과.pdf

      - name: Upload install guide TXT
        uses: actions/upload-artifact@v3
        with:
          name: 설치안내서-txt
          path: 설치안내서.txt

      - name: Upload QR image
        uses: actions/upload-artifact@v3
        with:
          name: QR_설치-png
          path: QR_설치.png
