# .github/workflows/android.yml
name: Build Cordova APK

# í‘¸ì‹œ(Push) / PR ìƒì„±(PR) ì‹œ ì›Œí¬í”Œë¡œ ì‹¤í–‰
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    name: ğŸ“¦ Build Android APK
    runs-on: ubuntu-latest

    steps:
      # 1) ê¹ƒ í´ë¡ 
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2) Java ì„¤ì¹˜ (Android SDK ìš”êµ¬)
      - name: Set up Java 11
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '11'

      # 3) Node.js ì„¤ì¹˜ (Cordova / npm í•„ìš”)
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'     # í”„ë¡œì íŠ¸ì— ë§ê²Œ ì¡°ì •

      # 4) ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: npm ci

      # 5) Cordova Android í”Œë«í¼ ì¶”ê°€ / ë¹Œë“œ ì¤€ë¹„
      - name: Prepare Cordova Android
        run: |
          npx cordova platform rm android || true
          npx cordova platform add android@11.0.0   # ë²„ì „ ì¡°ì • ê°€ëŠ¥

      # 6) APK ë””ë²„ê·¸ ë¹Œë“œ
      - name: Build APK (debug)
        run: npx cordova build android --debug

      # 7) ì•„í‹°íŒ©íŠ¸(ë¹Œë“œ ê²°ê³¼ë¬¼) ì—…ë¡œë“œ
      - name: Upload APK artifact
        uses: actions/upload-artifact@v3
        with:
          name: app-debug-apk
          path: platforms/android/app/build/outputs/apk/debug/app-debug.apk

      # (ì„ íƒ) ì¶”ê°€ ë³´ì¡° íŒŒì¼ ì—…ë¡œë“œ
      - name: Upload CSV statistics
        uses: actions/upload-artifact@v3
        with:
          name: ë¶ë§ˆí¬í†µê³„-csv
          path: ë¶ë§ˆí¬í†µê³„.csv

      - name: Upload PDF recommendation
        uses: actions/upload-artifact@v3
        with:
          name: ì¶”ì²œê²°ê³¼-pdf
          path: ì¶”ì²œê²°ê³¼.pdf

      - name: Upload install guide TXT
        uses: actions/upload-artifact@v3
        with:
          name: ì„¤ì¹˜ì•ˆë‚´ì„œ-txt
          path: ì„¤ì¹˜ì•ˆë‚´ì„œ.txt

      - name: Upload QR image
        uses: actions/upload-artifact@v3
        with:
          name: QR_ì„¤ì¹˜-png
          path: QR_ì„¤ì¹˜.png
